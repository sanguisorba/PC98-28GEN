# PC98-28GEN
拡張漢字ROMジェネレータ 28GEN

拡張漢字内蔵機種から文字パターンROMを取得し、
PC-9801-28相当の拡張漢字ROMを生成します

コンパイル済のバイナリは Releases からどうぞ

## 用意するもの
* 拡張漢字を内蔵／搭載したPC98実機
  * 8086機やハイレゾ環境下では動作しないと思います
* MS-DOS環境
  * 本プログラムはQuick C 1.1で作成しました
* EPROM D27128またはD27256
  * 本物のPC-9801-28はD27128です
* ROMライタ
  * EPROMを焼くために必要

## やり方
* 拡張漢字を内蔵／搭載しているPC98実機上で28GEN.EXEを実行してください
* 実行すると128.BINと256.BINというバイナリファイルが出力されます
* 128.BINをバイナリエディタで閲覧することをおすすめします
  * アドレス0800以降に何かしらデータがあればOK　全部FFとか00とかは失敗
* 128.BINをEPROM D27128、または256.BINをEPROM D27256に焼いてください
* PC-9801-28対象機種に焼いたEPROMを搭載すると拡張漢字が表示できます

## 免責事項
* 本プログラムはソースコードの公開を唯一のサポートとします
* 本プログラムに起因する損害等に対して作者は一切責任は負いません
* 実行した結果に対する保証もありません　自己責任でご利用ください
* 著作権にご注意ください（私的利用の範囲を超えない事）

## 技術メモ
当初はエミュレータ用ファイル"FONT.ROM"を読んで、そこから作ろうとしていました。<br>
"j"とか"k"とかの変数名やbitrevのループ文不使用はその名残です。<br>
結局スタック不足で諦め、I/Oポートを叩いて文字パターンROMを取得しています。<br>

Quick CのIDEではコンパイルエラーが出るので、"QCL"から直接コンパイルしました。
```
QCL /AM /O 28GEN.C
```

* 文字パターンROMのIOポート仕様はこんな感じです。
  * I/O A1H : 文字コード第2バイトライト
    * ライトデータ: JISコードの下位アドレス
  * I/O A3H : 文字コード第1バイトライト
    * ライトデータ: JISコードの上位アドレス - 0x20
  * I/O A5H : 文字パターン行指定カウンタライト
    * ライトデータ<br>
      D7:常に0<br>
      D6:常に0<br>
      D5:0=左半分, 1=右半分<br>
      D4 - D0: カウンタビット.<br>
      今回のような漢字パターンではD4 = don't care
  * I/O A9H : 文字パターンREAD
    * A5Hを走査して、左右合わせて32バイトのデータを得る

* おまじないとして 68Hも叩いています
  * I/O 60H-6FH : テキスト画面用CRTコントローラ (7220)
  * I/O 68H : モードフリップフロップコントロール(1)
    * ライトデータ<br>
      D7-D4:常に0<br>
      D3-D1:MFA<br>
      D0:MFDT

* 今回使っているライトデータの意味
  * MFA=0x8, MFDT=0 (0x8) :88グラフモードは「200本を強制しない」
  * MFA=0xA, MFDT=0 (0xA) :漢字アクセスモードは「コードアクセス」 
  * MFA=0xA, MFDT=1 (0xB) :漢字アクセスモードは「ビットマップ」
